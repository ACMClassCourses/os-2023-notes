[[API]]
中断机制：CPU在执行指令时，收到某个中断信号转而去执行预先设定好的代码，然后再返回到原指令流中继续执行，这就是中断机制
### software interruption
A software interrupt is a type of interrupt ==generated by software, rather than a hardware device==, in a computer system. It is used to request a service or notify the operating system kernel of an event.
When a software interrupt is generated, the CPU suspends the execution of the current program and switches to kernel mode to execute a corresponding software interrupt handler routine.
Software interrupts are often used by ==applications to communicate with the operating system or to **request services from the kernel==**
### hardware interruption
A hardware interrupt is a signal generated by a hardware device.
When a hardware interrupt occurs, the CPU stops the current task it is executing and switches to a special mode called ==interrupt mode== to handle the interrupt. The processor saves the current program state and registers, and then jumps to the appropriate ==interrupt handler routine==, which is **a small section of code** designed to handle the specific interrupt.
### softirq
Like hardware interrupts, softirqs are a type of interrupt that can **preempt the normal execution of the kernel and execute an interrupt handler routine** and has its own context. However, unlike hardware interrupts, softirqs are **generated by software**, not hardware devices.
A softirq is a mechanism used by the Linux kernel to handle deferred processing tasks that **require a high priority but cannot be handled directly in hardware interrupts**.
==used by the kernel to handle **high-priority** tasks that cannot be handled directly in hardware interrupts due to their complexity or overhead.==
Softirq handlers are executed in a **preemptive manner,** which means that they can be interrupted by higher-priority softirqs or hardware interrupts. This allows the kernel to handle high-priority tasks in a timely and efficient manner while maintaining system responsiveness and throughput.
硬件中断和硬中断一样
#### 中断的来源（区分软件/硬件中断）
1.外设，外设产生的中断信号是异步的，一般也叫做**硬件中断(** 注意硬中断是另外一个概念)。硬件中断按照是否可以屏蔽分为可屏蔽中断和不可屏蔽中断。例如，网卡、磁盘、定时器都可以产生硬件中断。

2.CPU，这里指的是一个CPU向另一个CPU发送中断，这种中断叫做IPI(处理器间中断)。IPI也可以看出是一种特殊的**硬件中断**，因为它和硬件中断的模式差不多，都是异步的。

3.CPU异常，CPU在执行指令的过程中发现异常会向自己发送中断信号，这种中断是同步的，一般也叫做**软件中断（由软件比如应用程序和操作系统来发起）** (注意软中断是另外一个概念)。CPU异常按照是否需要修复以及是否能修复分为3类：1.==陷阱(==trap)，不需要修复，中断处理完成后继续执行下一条指令，2.==故障==(fault)，需要修复也有可能修复，中断处理完成后重新执行之前的指令，3.==中止==(abort)，需要修复但是无法修复，中断处理完成后，进程或者内核将会崩溃。例如，缺页异常是一种故障，所以也叫缺页故障，缺页异常处理完成后会重新执行刚才的指令。
4.中断指令，直接用CPU指令来产生中断信号，这种中断和CPU异常一样是同步的，也可以叫做软件中断。例如，中断指令int 0x80可以用来实现系统调用。

#### 中断的作用
设计中断机制的目的在于中断机制有以下4个作用，这些作用可以帮助操作系统实现自己的功能。这四个作用分别是：
**1.外设异步通知CPU：** 外设发生了什么事情或者完成了什么任务或者有什么消息要告诉CPU，都可以异步给CPU发通知。例如，网卡收到了网络包，磁盘完成了IO任务，定时器的间隔时间到了，都可以给CPU发中断信号。
**2.CPU之间发送消息：** 在SMP系统中，一个CPU想要给另一个CPU发送消息，可以给其发送IPI(处理器间中断)。
**3.处理CPU异常：** CPU在执行指令的过程中遇到了异常会给自己发送中断信号来处理异常。例如，做整数除法运算的时候发现被除数是0，访问虚拟内存的时候发现虚拟内存没有映射到物理内存上。
**4.实现系统调用：** 早期的系统调用就是靠中断指令来实现的，后期虽然开发了专用的系统调用指令，但是其基本原理还是相似的。